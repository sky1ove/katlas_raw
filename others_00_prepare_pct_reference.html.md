# Get reference score to calculate percentile


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Setup

``` python
from katlas.imports import *
import pickle, pandas as pd,numpy as np, seaborn as sns,matplotlib.pyplot as plt
from numpy import trapz
```

## Scoring

Download supp table3 (sheet2) from [nature Ser/Thr kinase
paper](https://www.nature.com/articles/s41586-022-05575-3#Sec23) and
supp table3 (sheet3, with non-canonical) from [nature Tyr kinase
paper](https://www.nature.com/articles/s41586-024-07407-y#Sec33)

These two files are too big to upload to the current repository, please
download the files yourself.

``` python
# df = pd.read_csv('supp3_ST.csv')
df = pd.read_csv('supp3_tyr.csv')
```

Check whether the sequence contains lowercase other than the
phospho-acceptor

``` python
df['SITE_+/-7_AA'].str[0:7].str.contains('[a-z]').value_counts()
```

    SITE_+/-7_AA
    False    7315
    Name: count, dtype: int64

``` python
df['SITE_+/-7_AA'].str[8:].str.contains('[a-z]').value_counts()
```

    SITE_+/-7_AA
    False    7315
    Name: count, dtype: int64

It seems the sequence in the supp3 does not contains phosphorylated
sequence.

Convert column names

``` python
cols=df.columns[df.columns.str.contains('_percentile')][1:]

# get the target
target = df[cols]
```

``` python
target.columns = target.columns.str.split('_').str[0]
```

Below is for tyr only, as we need to transform the name to be consistent

``` python
kinase_dict = pd.read_csv('raw/lew_tyr_info.csv')
```

``` python
name_dict = kinase_dict.set_index('lew_kinase2')['kinase_tyr']
```

``` python
target.columns = target.columns.map(name_dict)
```

``` python
target.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ABL1</th>
<th data-quarto-table-cell-role="th">TNK2</th>
<th data-quarto-table-cell-role="th">ALK</th>
<th data-quarto-table-cell-role="th">ABL2</th>
<th data-quarto-table-cell-role="th">AXL</th>
<th data-quarto-table-cell-role="th">BLK</th>
<th data-quarto-table-cell-role="th">BMPR2_TYR</th>
<th data-quarto-table-cell-role="th">PTK6</th>
<th data-quarto-table-cell-role="th">BTK</th>
<th data-quarto-table-cell-role="th">CSF1R</th>
<th data-quarto-table-cell-role="th">CSK</th>
<th data-quarto-table-cell-role="th">MATK</th>
<th data-quarto-table-cell-role="th">DDR1</th>
<th data-quarto-table-cell-role="th">DDR2</th>
<th data-quarto-table-cell-role="th">EGFR</th>
<th data-quarto-table-cell-role="th">EPHA1</th>
<th data-quarto-table-cell-role="th">EPHA2</th>
<th data-quarto-table-cell-role="th">EPHA3</th>
<th data-quarto-table-cell-role="th">EPHA4</th>
<th data-quarto-table-cell-role="th">EPHA5</th>
<th data-quarto-table-cell-role="th">EPHA6</th>
<th data-quarto-table-cell-role="th">EPHA7</th>
<th data-quarto-table-cell-role="th">EPHA8</th>
<th data-quarto-table-cell-role="th">EPHB1</th>
<th data-quarto-table-cell-role="th">EPHB2</th>
<th data-quarto-table-cell-role="th">EPHB3</th>
<th data-quarto-table-cell-role="th">EPHB4</th>
<th data-quarto-table-cell-role="th">BMX</th>
<th data-quarto-table-cell-role="th">PTK2</th>
<th data-quarto-table-cell-role="th">FER</th>
<th data-quarto-table-cell-role="th">FES</th>
<th data-quarto-table-cell-role="th">FGFR1</th>
<th data-quarto-table-cell-role="th">FGFR2</th>
<th data-quarto-table-cell-role="th">FGFR3</th>
<th data-quarto-table-cell-role="th">FGFR4</th>
<th data-quarto-table-cell-role="th">FGR</th>
<th data-quarto-table-cell-role="th">FLT3</th>
<th data-quarto-table-cell-role="th">FRK</th>
<th data-quarto-table-cell-role="th">FYN</th>
<th data-quarto-table-cell-role="th">HCK</th>
<th data-quarto-table-cell-role="th">ERBB2</th>
<th data-quarto-table-cell-role="th">ERBB4</th>
<th data-quarto-table-cell-role="th">IGF1R</th>
<th data-quarto-table-cell-role="th">INSR</th>
<th data-quarto-table-cell-role="th">INSRR</th>
<th data-quarto-table-cell-role="th">ITK</th>
<th data-quarto-table-cell-role="th">JAK1</th>
<th data-quarto-table-cell-role="th">JAK2</th>
<th data-quarto-table-cell-role="th">JAK3</th>
<th data-quarto-table-cell-role="th">KIT</th>
<th data-quarto-table-cell-role="th">LCK</th>
<th data-quarto-table-cell-role="th">LIMK1_TYR</th>
<th data-quarto-table-cell-role="th">LIMK2_TYR</th>
<th data-quarto-table-cell-role="th">LTK</th>
<th data-quarto-table-cell-role="th">LYN</th>
<th data-quarto-table-cell-role="th">MERTK</th>
<th data-quarto-table-cell-role="th">MET</th>
<th data-quarto-table-cell-role="th">MAP2K4_TYR</th>
<th data-quarto-table-cell-role="th">MAP2K6_TYR</th>
<th data-quarto-table-cell-role="th">MAP2K7_TYR</th>
<th data-quarto-table-cell-role="th">MST1R</th>
<th data-quarto-table-cell-role="th">MUSK</th>
<th data-quarto-table-cell-role="th">PKMYT1_TYR</th>
<th data-quarto-table-cell-role="th">NEK10_TYR</th>
<th data-quarto-table-cell-role="th">PDGFRA</th>
<th data-quarto-table-cell-role="th">PDGFRB</th>
<th data-quarto-table-cell-role="th">PDHK1_TYR</th>
<th data-quarto-table-cell-role="th">PDHK3_TYR</th>
<th data-quarto-table-cell-role="th">PDHK4_TYR</th>
<th data-quarto-table-cell-role="th">PINK1_TYR</th>
<th data-quarto-table-cell-role="th">PTK2B</th>
<th data-quarto-table-cell-role="th">RET</th>
<th data-quarto-table-cell-role="th">ROS1</th>
<th data-quarto-table-cell-role="th">SRC</th>
<th data-quarto-table-cell-role="th">SRMS</th>
<th data-quarto-table-cell-role="th">SYK</th>
<th data-quarto-table-cell-role="th">TEC</th>
<th data-quarto-table-cell-role="th">TESK1_TYR</th>
<th data-quarto-table-cell-role="th">TEK</th>
<th data-quarto-table-cell-role="th">TNK1</th>
<th data-quarto-table-cell-role="th">TNNI3K_TYR</th>
<th data-quarto-table-cell-role="th">NTRK1</th>
<th data-quarto-table-cell-role="th">NTRK2</th>
<th data-quarto-table-cell-role="th">NTRK3</th>
<th data-quarto-table-cell-role="th">TXK</th>
<th data-quarto-table-cell-role="th">TYK2</th>
<th data-quarto-table-cell-role="th">TYRO3</th>
<th data-quarto-table-cell-role="th">FLT1</th>
<th data-quarto-table-cell-role="th">KDR</th>
<th data-quarto-table-cell-role="th">FLT4</th>
<th data-quarto-table-cell-role="th">WEE1_TYR</th>
<th data-quarto-table-cell-role="th">YES1</th>
<th data-quarto-table-cell-role="th">ZAP70</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>36.18</td>
<td>6.22</td>
<td>27.40</td>
<td>46.44</td>
<td>49.64</td>
<td>87.22</td>
<td>78.99</td>
<td>98.40</td>
<td>71.50</td>
<td>26.37</td>
<td>90.22</td>
<td>93.41</td>
<td>12.52</td>
<td>22.11</td>
<td>79.36</td>
<td>18.85</td>
<td>58.28</td>
<td>37.30</td>
<td>69.07</td>
<td>71.50</td>
<td>24.25</td>
<td>27.75</td>
<td>64.70</td>
<td>41.30</td>
<td>76.43</td>
<td>59.62</td>
<td>42.81</td>
<td>61.77</td>
<td>91.84</td>
<td>95.64</td>
<td>79.32</td>
<td>25.83</td>
<td>41.72</td>
<td>63.80</td>
<td>89.69</td>
<td>94.16</td>
<td>38.89</td>
<td>42.42</td>
<td>99.87</td>
<td>90.09</td>
<td>41.93</td>
<td>58.44</td>
<td>86.36</td>
<td>51.67</td>
<td>57.80</td>
<td>61.20</td>
<td>5.36</td>
<td>6.46</td>
<td>8.84</td>
<td>34.86</td>
<td>83.74</td>
<td>2.54</td>
<td>2.34</td>
<td>54.93</td>
<td>83.98</td>
<td>78.71</td>
<td>27.29</td>
<td>41.43</td>
<td>92.16</td>
<td>51.72</td>
<td>5.28</td>
<td>17.51</td>
<td>12.72</td>
<td>7.70</td>
<td>3.17</td>
<td>22.57</td>
<td>96.65</td>
<td>70.10</td>
<td>74.98</td>
<td>77.46</td>
<td>76.65</td>
<td>39.40</td>
<td>7.86</td>
<td>98.82</td>
<td>88.18</td>
<td>86.48</td>
<td>58.13</td>
<td>0.85</td>
<td>16.63</td>
<td>7.79</td>
<td>0.68</td>
<td>82.19</td>
<td>57.28</td>
<td>57.63</td>
<td>73.82</td>
<td>16.04</td>
<td>27.23</td>
<td>51.22</td>
<td>21.43</td>
<td>37.76</td>
<td>47.45</td>
<td>99.67</td>
<td>62.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>72.93</td>
<td>31.82</td>
<td>45.68</td>
<td>60.52</td>
<td>41.74</td>
<td>34.16</td>
<td>40.25</td>
<td>69.07</td>
<td>47.87</td>
<td>38.26</td>
<td>74.41</td>
<td>62.25</td>
<td>69.23</td>
<td>43.84</td>
<td>66.23</td>
<td>61.17</td>
<td>76.28</td>
<td>45.94</td>
<td>51.26</td>
<td>40.58</td>
<td>62.25</td>
<td>46.36</td>
<td>46.36</td>
<td>36.40</td>
<td>31.87</td>
<td>28.93</td>
<td>16.52</td>
<td>36.00</td>
<td>27.03</td>
<td>41.94</td>
<td>60.14</td>
<td>40.12</td>
<td>67.21</td>
<td>57.41</td>
<td>68.86</td>
<td>24.32</td>
<td>50.71</td>
<td>37.53</td>
<td>35.76</td>
<td>50.03</td>
<td>66.64</td>
<td>35.72</td>
<td>42.17</td>
<td>47.12</td>
<td>43.38</td>
<td>24.05</td>
<td>34.25</td>
<td>51.28</td>
<td>47.06</td>
<td>65.70</td>
<td>41.34</td>
<td>54.30</td>
<td>70.01</td>
<td>60.52</td>
<td>45.30</td>
<td>43.86</td>
<td>47.49</td>
<td>52.27</td>
<td>23.03</td>
<td>60.08</td>
<td>59.09</td>
<td>48.17</td>
<td>26.40</td>
<td>96.04</td>
<td>53.40</td>
<td>32.85</td>
<td>61.31</td>
<td>74.96</td>
<td>37.58</td>
<td>50.25</td>
<td>57.78</td>
<td>71.04</td>
<td>17.07</td>
<td>49.22</td>
<td>61.17</td>
<td>30.66</td>
<td>56.25</td>
<td>36.92</td>
<td>16.90</td>
<td>47.01</td>
<td>17.29</td>
<td>44.76</td>
<td>45.41</td>
<td>49.90</td>
<td>44.37</td>
<td>44.52</td>
<td>36.18</td>
<td>64.74</td>
<td>33.12</td>
<td>50.84</td>
<td>40.25</td>
<td>46.09</td>
<td>15.02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.11</td>
<td>75.58</td>
<td>2.80</td>
<td>2.85</td>
<td>23.33</td>
<td>0.41</td>
<td>33.75</td>
<td>14.55</td>
<td>10.83</td>
<td>9.41</td>
<td>26.77</td>
<td>22.19</td>
<td>20.42</td>
<td>25.69</td>
<td>2.52</td>
<td>23.51</td>
<td>5.62</td>
<td>16.81</td>
<td>16.13</td>
<td>8.84</td>
<td>41.58</td>
<td>21.67</td>
<td>6.00</td>
<td>3.44</td>
<td>3.52</td>
<td>8.29</td>
<td>9.37</td>
<td>2.98</td>
<td>9.70</td>
<td>0.35</td>
<td>3.26</td>
<td>9.45</td>
<td>18.80</td>
<td>7.05</td>
<td>1.73</td>
<td>1.53</td>
<td>28.63</td>
<td>7.77</td>
<td>1.10</td>
<td>0.24</td>
<td>2.52</td>
<td>2.78</td>
<td>0.57</td>
<td>1.20</td>
<td>1.29</td>
<td>3.20</td>
<td>9.26</td>
<td>9.02</td>
<td>24.05</td>
<td>10.35</td>
<td>0.61</td>
<td>97.24</td>
<td>92.14</td>
<td>4.11</td>
<td>1.36</td>
<td>2.56</td>
<td>12.32</td>
<td>12.02</td>
<td>28.93</td>
<td>94.92</td>
<td>25.12</td>
<td>15.12</td>
<td>84.33</td>
<td>68.74</td>
<td>50.93</td>
<td>25.13</td>
<td>64.67</td>
<td>37.47</td>
<td>75.49</td>
<td>86.50</td>
<td>2.36</td>
<td>20.36</td>
<td>10.02</td>
<td>0.68</td>
<td>3.96</td>
<td>1.57</td>
<td>3.22</td>
<td>96.45</td>
<td>23.03</td>
<td>86.41</td>
<td>68.24</td>
<td>1.36</td>
<td>1.42</td>
<td>0.33</td>
<td>1.95</td>
<td>29.09</td>
<td>11.86</td>
<td>24.97</td>
<td>29.11</td>
<td>35.98</td>
<td>97.79</td>
<td>1.36</td>
<td>1.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>81.77</td>
<td>87.26</td>
<td>41.91</td>
<td>83.34</td>
<td>83.72</td>
<td>54.91</td>
<td>24.01</td>
<td>51.59</td>
<td>63.93</td>
<td>29.72</td>
<td>59.95</td>
<td>66.97</td>
<td>17.75</td>
<td>4.20</td>
<td>16.79</td>
<td>85.64</td>
<td>61.11</td>
<td>78.49</td>
<td>58.44</td>
<td>70.59</td>
<td>68.81</td>
<td>66.71</td>
<td>54.00</td>
<td>61.54</td>
<td>69.60</td>
<td>80.30</td>
<td>84.39</td>
<td>67.56</td>
<td>59.77</td>
<td>60.89</td>
<td>28.37</td>
<td>10.64</td>
<td>9.69</td>
<td>8.71</td>
<td>11.78</td>
<td>59.40</td>
<td>57.10</td>
<td>60.93</td>
<td>32.20</td>
<td>51.06</td>
<td>18.87</td>
<td>28.89</td>
<td>12.23</td>
<td>19.22</td>
<td>12.34</td>
<td>62.79</td>
<td>49.11</td>
<td>23.44</td>
<td>17.31</td>
<td>21.84</td>
<td>71.33</td>
<td>90.33</td>
<td>85.16</td>
<td>58.64</td>
<td>51.30</td>
<td>77.52</td>
<td>41.39</td>
<td>95.03</td>
<td>53.82</td>
<td>54.58</td>
<td>67.23</td>
<td>75.29</td>
<td>59.34</td>
<td>71.70</td>
<td>47.63</td>
<td>40.56</td>
<td>35.11</td>
<td>60.54</td>
<td>30.62</td>
<td>86.12</td>
<td>88.82</td>
<td>45.66</td>
<td>39.27</td>
<td>18.91</td>
<td>60.71</td>
<td>45.68</td>
<td>74.22</td>
<td>63.54</td>
<td>59.31</td>
<td>43.42</td>
<td>44.50</td>
<td>28.26</td>
<td>45.13</td>
<td>39.29</td>
<td>81.42</td>
<td>13.09</td>
<td>75.40</td>
<td>27.66</td>
<td>33.97</td>
<td>18.85</td>
<td>87.66</td>
<td>30.93</td>
<td>45.39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>30.44</td>
<td>30.38</td>
<td>39.00</td>
<td>26.64</td>
<td>60.36</td>
<td>38.28</td>
<td>88.22</td>
<td>62.60</td>
<td>76.95</td>
<td>80.45</td>
<td>64.19</td>
<td>87.20</td>
<td>56.38</td>
<td>67.89</td>
<td>79.05</td>
<td>60.60</td>
<td>64.35</td>
<td>72.51</td>
<td>55.90</td>
<td>70.15</td>
<td>81.44</td>
<td>70.72</td>
<td>73.69</td>
<td>65.46</td>
<td>76.19</td>
<td>72.31</td>
<td>89.08</td>
<td>67.59</td>
<td>61.44</td>
<td>29.11</td>
<td>44.23</td>
<td>75.31</td>
<td>48.02</td>
<td>52.27</td>
<td>61.68</td>
<td>69.12</td>
<td>79.49</td>
<td>55.66</td>
<td>27.51</td>
<td>46.03</td>
<td>64.98</td>
<td>60.38</td>
<td>65.24</td>
<td>83.98</td>
<td>51.35</td>
<td>79.60</td>
<td>85.99</td>
<td>56.95</td>
<td>93.52</td>
<td>68.90</td>
<td>57.17</td>
<td>48.72</td>
<td>44.74</td>
<td>27.71</td>
<td>40.64</td>
<td>40.27</td>
<td>83.12</td>
<td>33.14</td>
<td>46.18</td>
<td>14.64</td>
<td>85.51</td>
<td>94.37</td>
<td>59.55</td>
<td>61.43</td>
<td>92.23</td>
<td>96.87</td>
<td>27.66</td>
<td>33.00</td>
<td>35.46</td>
<td>34.56</td>
<td>36.97</td>
<td>68.35</td>
<td>83.94</td>
<td>48.41</td>
<td>21.97</td>
<td>68.62</td>
<td>60.93</td>
<td>44.93</td>
<td>86.25</td>
<td>46.66</td>
<td>98.80</td>
<td>70.61</td>
<td>94.84</td>
<td>86.87</td>
<td>56.16</td>
<td>70.65</td>
<td>84.24</td>
<td>80.78</td>
<td>72.93</td>
<td>79.01</td>
<td>95.19</td>
<td>39.35</td>
<td>74.46</td>
</tr>
</tbody>
</table>

</div>

## Scoring

``` python
result = predict_kinase_df(df,'SITE_+/-7_AA',**param_PSPA)
```

    input dataframe has a length 7315
    Preprocessing
    Finish preprocessing
    Merging reference
    Finish merging

    100%|██████████| 396/396 [00:02<00:00, 157.53it/s]

``` python
# get the percentile score
percentile = result[target.columns].rank(axis=0,pct=True)
```

``` python
percentile = (percentile*100).round(2)
```

``` python
percentile.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ABL1</th>
<th data-quarto-table-cell-role="th">TNK2</th>
<th data-quarto-table-cell-role="th">ALK</th>
<th data-quarto-table-cell-role="th">ABL2</th>
<th data-quarto-table-cell-role="th">AXL</th>
<th data-quarto-table-cell-role="th">BLK</th>
<th data-quarto-table-cell-role="th">BMPR2_TYR</th>
<th data-quarto-table-cell-role="th">PTK6</th>
<th data-quarto-table-cell-role="th">BTK</th>
<th data-quarto-table-cell-role="th">CSF1R</th>
<th data-quarto-table-cell-role="th">CSK</th>
<th data-quarto-table-cell-role="th">MATK</th>
<th data-quarto-table-cell-role="th">DDR1</th>
<th data-quarto-table-cell-role="th">DDR2</th>
<th data-quarto-table-cell-role="th">EGFR</th>
<th data-quarto-table-cell-role="th">EPHA1</th>
<th data-quarto-table-cell-role="th">EPHA2</th>
<th data-quarto-table-cell-role="th">EPHA3</th>
<th data-quarto-table-cell-role="th">EPHA4</th>
<th data-quarto-table-cell-role="th">EPHA5</th>
<th data-quarto-table-cell-role="th">EPHA6</th>
<th data-quarto-table-cell-role="th">EPHA7</th>
<th data-quarto-table-cell-role="th">EPHA8</th>
<th data-quarto-table-cell-role="th">EPHB1</th>
<th data-quarto-table-cell-role="th">EPHB2</th>
<th data-quarto-table-cell-role="th">EPHB3</th>
<th data-quarto-table-cell-role="th">EPHB4</th>
<th data-quarto-table-cell-role="th">BMX</th>
<th data-quarto-table-cell-role="th">PTK2</th>
<th data-quarto-table-cell-role="th">FER</th>
<th data-quarto-table-cell-role="th">FES</th>
<th data-quarto-table-cell-role="th">FGFR1</th>
<th data-quarto-table-cell-role="th">FGFR2</th>
<th data-quarto-table-cell-role="th">FGFR3</th>
<th data-quarto-table-cell-role="th">FGFR4</th>
<th data-quarto-table-cell-role="th">FGR</th>
<th data-quarto-table-cell-role="th">FLT3</th>
<th data-quarto-table-cell-role="th">FRK</th>
<th data-quarto-table-cell-role="th">FYN</th>
<th data-quarto-table-cell-role="th">HCK</th>
<th data-quarto-table-cell-role="th">ERBB2</th>
<th data-quarto-table-cell-role="th">ERBB4</th>
<th data-quarto-table-cell-role="th">IGF1R</th>
<th data-quarto-table-cell-role="th">INSR</th>
<th data-quarto-table-cell-role="th">INSRR</th>
<th data-quarto-table-cell-role="th">ITK</th>
<th data-quarto-table-cell-role="th">JAK1</th>
<th data-quarto-table-cell-role="th">JAK2</th>
<th data-quarto-table-cell-role="th">JAK3</th>
<th data-quarto-table-cell-role="th">KIT</th>
<th data-quarto-table-cell-role="th">LCK</th>
<th data-quarto-table-cell-role="th">LIMK1_TYR</th>
<th data-quarto-table-cell-role="th">LIMK2_TYR</th>
<th data-quarto-table-cell-role="th">LTK</th>
<th data-quarto-table-cell-role="th">LYN</th>
<th data-quarto-table-cell-role="th">MERTK</th>
<th data-quarto-table-cell-role="th">MET</th>
<th data-quarto-table-cell-role="th">MAP2K4_TYR</th>
<th data-quarto-table-cell-role="th">MAP2K6_TYR</th>
<th data-quarto-table-cell-role="th">MAP2K7_TYR</th>
<th data-quarto-table-cell-role="th">MST1R</th>
<th data-quarto-table-cell-role="th">MUSK</th>
<th data-quarto-table-cell-role="th">PKMYT1_TYR</th>
<th data-quarto-table-cell-role="th">NEK10_TYR</th>
<th data-quarto-table-cell-role="th">PDGFRA</th>
<th data-quarto-table-cell-role="th">PDGFRB</th>
<th data-quarto-table-cell-role="th">PDHK1_TYR</th>
<th data-quarto-table-cell-role="th">PDHK3_TYR</th>
<th data-quarto-table-cell-role="th">PDHK4_TYR</th>
<th data-quarto-table-cell-role="th">PINK1_TYR</th>
<th data-quarto-table-cell-role="th">PTK2B</th>
<th data-quarto-table-cell-role="th">RET</th>
<th data-quarto-table-cell-role="th">ROS1</th>
<th data-quarto-table-cell-role="th">SRC</th>
<th data-quarto-table-cell-role="th">SRMS</th>
<th data-quarto-table-cell-role="th">SYK</th>
<th data-quarto-table-cell-role="th">TEC</th>
<th data-quarto-table-cell-role="th">TESK1_TYR</th>
<th data-quarto-table-cell-role="th">TEK</th>
<th data-quarto-table-cell-role="th">TNK1</th>
<th data-quarto-table-cell-role="th">TNNI3K_TYR</th>
<th data-quarto-table-cell-role="th">NTRK1</th>
<th data-quarto-table-cell-role="th">NTRK2</th>
<th data-quarto-table-cell-role="th">NTRK3</th>
<th data-quarto-table-cell-role="th">TXK</th>
<th data-quarto-table-cell-role="th">TYK2</th>
<th data-quarto-table-cell-role="th">TYRO3</th>
<th data-quarto-table-cell-role="th">FLT1</th>
<th data-quarto-table-cell-role="th">KDR</th>
<th data-quarto-table-cell-role="th">FLT4</th>
<th data-quarto-table-cell-role="th">WEE1_TYR</th>
<th data-quarto-table-cell-role="th">YES1</th>
<th data-quarto-table-cell-role="th">ZAP70</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>36.90</td>
<td>6.23</td>
<td>26.32</td>
<td>46.87</td>
<td>49.48</td>
<td>87.50</td>
<td>78.57</td>
<td>98.49</td>
<td>71.71</td>
<td>25.83</td>
<td>89.54</td>
<td>93.08</td>
<td>12.08</td>
<td>21.67</td>
<td>77.75</td>
<td>18.28</td>
<td>57.33</td>
<td>36.49</td>
<td>67.95</td>
<td>70.62</td>
<td>24.37</td>
<td>27.27</td>
<td>63.62</td>
<td>41.39</td>
<td>75.71</td>
<td>59.68</td>
<td>43.03</td>
<td>62.14</td>
<td>91.13</td>
<td>95.52</td>
<td>78.35</td>
<td>25.27</td>
<td>40.98</td>
<td>62.66</td>
<td>88.20</td>
<td>94.21</td>
<td>36.96</td>
<td>41.16</td>
<td>99.84</td>
<td>90.01</td>
<td>40.20</td>
<td>57.33</td>
<td>85.35</td>
<td>50.85</td>
<td>57.27</td>
<td>61.66</td>
<td>5.32</td>
<td>6.25</td>
<td>8.63</td>
<td>34.05</td>
<td>84.16</td>
<td>3.10</td>
<td>2.80</td>
<td>54.25</td>
<td>83.56</td>
<td>78.68</td>
<td>27.61</td>
<td>42.73</td>
<td>92.39</td>
<td>52.09</td>
<td>5.41</td>
<td>16.96</td>
<td>13.69</td>
<td>8.03</td>
<td>2.92</td>
<td>21.61</td>
<td>96.40</td>
<td>70.79</td>
<td>75.19</td>
<td>77.29</td>
<td>76.60</td>
<td>38.91</td>
<td>7.80</td>
<td>98.78</td>
<td>87.28</td>
<td>85.72</td>
<td>57.67</td>
<td>1.11</td>
<td>16.04</td>
<td>8.06</td>
<td>0.77</td>
<td>80.68</td>
<td>55.93</td>
<td>56.02</td>
<td>74.24</td>
<td>15.55</td>
<td>27.09</td>
<td>50.01</td>
<td>20.96</td>
<td>36.08</td>
<td>48.09</td>
<td>99.69</td>
<td>62.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>73.94</td>
<td>31.87</td>
<td>45.08</td>
<td>61.11</td>
<td>41.85</td>
<td>34.85</td>
<td>40.27</td>
<td>69.06</td>
<td>47.25</td>
<td>37.45</td>
<td>73.02</td>
<td>61.91</td>
<td>69.23</td>
<td>43.32</td>
<td>64.44</td>
<td>60.55</td>
<td>74.88</td>
<td>44.68</td>
<td>50.25</td>
<td>39.88</td>
<td>61.72</td>
<td>45.71</td>
<td>45.65</td>
<td>36.37</td>
<td>31.93</td>
<td>28.73</td>
<td>17.05</td>
<td>35.85</td>
<td>26.68</td>
<td>41.67</td>
<td>58.79</td>
<td>39.35</td>
<td>66.12</td>
<td>56.15</td>
<td>67.02</td>
<td>24.81</td>
<td>48.69</td>
<td>36.55</td>
<td>36.03</td>
<td>50.15</td>
<td>65.15</td>
<td>35.11</td>
<td>41.13</td>
<td>46.32</td>
<td>42.75</td>
<td>24.33</td>
<td>33.27</td>
<td>49.55</td>
<td>46.72</td>
<td>63.94</td>
<td>41.44</td>
<td>55.50</td>
<td>71.09</td>
<td>60.08</td>
<td>45.00</td>
<td>43.78</td>
<td>47.36</td>
<td>53.40</td>
<td>23.47</td>
<td>59.51</td>
<td>58.15</td>
<td>47.46</td>
<td>27.73</td>
<td>95.82</td>
<td>52.02</td>
<td>31.86</td>
<td>60.87</td>
<td>75.47</td>
<td>37.70</td>
<td>50.42</td>
<td>57.81</td>
<td>70.94</td>
<td>16.81</td>
<td>49.34</td>
<td>61.06</td>
<td>30.30</td>
<td>55.67</td>
<td>38.15</td>
<td>16.22</td>
<td>47.40</td>
<td>18.19</td>
<td>43.98</td>
<td>44.49</td>
<td>48.59</td>
<td>45.42</td>
<td>42.92</td>
<td>36.49</td>
<td>63.37</td>
<td>32.42</td>
<td>49.25</td>
<td>41.07</td>
<td>46.65</td>
<td>15.55</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.01</td>
<td>76.08</td>
<td>2.55</td>
<td>2.80</td>
<td>23.14</td>
<td>0.43</td>
<td>33.66</td>
<td>14.39</td>
<td>10.26</td>
<td>9.00</td>
<td>25.57</td>
<td>21.89</td>
<td>19.71</td>
<td>25.13</td>
<td>2.59</td>
<td>22.71</td>
<td>5.43</td>
<td>16.93</td>
<td>16.00</td>
<td>8.59</td>
<td>41.55</td>
<td>21.48</td>
<td>5.87</td>
<td>3.41</td>
<td>3.63</td>
<td>8.22</td>
<td>9.58</td>
<td>3.06</td>
<td>9.70</td>
<td>0.33</td>
<td>3.30</td>
<td>9.23</td>
<td>18.08</td>
<td>6.86</td>
<td>1.88</td>
<td>1.58</td>
<td>27.13</td>
<td>7.29</td>
<td>1.32</td>
<td>0.28</td>
<td>2.32</td>
<td>2.93</td>
<td>0.57</td>
<td>1.21</td>
<td>1.21</td>
<td>3.34</td>
<td>9.22</td>
<td>8.74</td>
<td>23.86</td>
<td>9.67</td>
<td>0.65</td>
<td>96.85</td>
<td>92.00</td>
<td>3.79</td>
<td>1.32</td>
<td>2.48</td>
<td>12.32</td>
<td>13.02</td>
<td>29.02</td>
<td>94.74</td>
<td>25.00</td>
<td>14.46</td>
<td>84.91</td>
<td>68.87</td>
<td>49.34</td>
<td>24.04</td>
<td>64.31</td>
<td>38.23</td>
<td>75.62</td>
<td>86.30</td>
<td>2.55</td>
<td>20.02</td>
<td>9.95</td>
<td>0.73</td>
<td>4.05</td>
<td>1.62</td>
<td>3.06</td>
<td>96.47</td>
<td>22.48</td>
<td>86.21</td>
<td>68.06</td>
<td>1.51</td>
<td>1.35</td>
<td>0.40</td>
<td>2.00</td>
<td>27.79</td>
<td>11.75</td>
<td>23.90</td>
<td>28.22</td>
<td>34.54</td>
<td>97.48</td>
<td>1.47</td>
<td>1.13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>82.29</td>
<td>87.57</td>
<td>41.46</td>
<td>83.82</td>
<td>83.94</td>
<td>55.37</td>
<td>23.93</td>
<td>51.19</td>
<td>63.75</td>
<td>29.02</td>
<td>58.52</td>
<td>66.27</td>
<td>17.08</td>
<td>4.27</td>
<td>16.53</td>
<td>85.72</td>
<td>59.79</td>
<td>77.56</td>
<td>57.29</td>
<td>69.70</td>
<td>68.59</td>
<td>65.58</td>
<td>53.55</td>
<td>60.72</td>
<td>68.81</td>
<td>79.94</td>
<td>84.15</td>
<td>67.80</td>
<td>59.45</td>
<td>60.17</td>
<td>27.33</td>
<td>10.42</td>
<td>9.26</td>
<td>8.47</td>
<td>11.31</td>
<td>59.98</td>
<td>55.28</td>
<td>59.82</td>
<td>32.71</td>
<td>51.19</td>
<td>17.87</td>
<td>28.43</td>
<td>11.50</td>
<td>18.82</td>
<td>12.15</td>
<td>63.41</td>
<td>47.95</td>
<td>22.69</td>
<td>17.00</td>
<td>21.00</td>
<td>72.05</td>
<td>90.03</td>
<td>85.13</td>
<td>57.96</td>
<td>51.13</td>
<td>77.29</td>
<td>41.63</td>
<td>95.50</td>
<td>54.62</td>
<td>54.94</td>
<td>66.61</td>
<td>74.57</td>
<td>60.31</td>
<td>71.74</td>
<td>46.24</td>
<td>39.64</td>
<td>35.13</td>
<td>61.16</td>
<td>30.64</td>
<td>86.02</td>
<td>88.81</td>
<td>44.81</td>
<td>39.30</td>
<td>19.16</td>
<td>60.64</td>
<td>44.98</td>
<td>74.25</td>
<td>64.19</td>
<td>59.13</td>
<td>43.81</td>
<td>44.76</td>
<td>27.50</td>
<td>44.24</td>
<td>38.65</td>
<td>81.51</td>
<td>12.64</td>
<td>75.78</td>
<td>26.61</td>
<td>33.20</td>
<td>17.67</td>
<td>86.80</td>
<td>31.91</td>
<td>45.39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>31.05</td>
<td>30.53</td>
<td>38.42</td>
<td>28.13</td>
<td>60.13</td>
<td>38.78</td>
<td>88.18</td>
<td>62.51</td>
<td>77.00</td>
<td>79.15</td>
<td>62.96</td>
<td>86.69</td>
<td>55.73</td>
<td>67.27</td>
<td>77.48</td>
<td>59.87</td>
<td>63.15</td>
<td>71.18</td>
<td>54.73</td>
<td>69.28</td>
<td>81.18</td>
<td>69.69</td>
<td>72.53</td>
<td>64.53</td>
<td>75.33</td>
<td>71.95</td>
<td>88.88</td>
<td>67.85</td>
<td>60.99</td>
<td>28.97</td>
<td>42.93</td>
<td>74.40</td>
<td>47.06</td>
<td>50.79</td>
<td>60.36</td>
<td>69.69</td>
<td>78.28</td>
<td>55.02</td>
<td>27.99</td>
<td>46.10</td>
<td>63.34</td>
<td>59.35</td>
<td>64.19</td>
<td>82.99</td>
<td>50.90</td>
<td>80.06</td>
<td>85.22</td>
<td>54.84</td>
<td>93.25</td>
<td>67.05</td>
<td>57.78</td>
<td>49.97</td>
<td>47.05</td>
<td>27.16</td>
<td>40.51</td>
<td>40.21</td>
<td>82.30</td>
<td>34.11</td>
<td>46.84</td>
<td>14.78</td>
<td>85.42</td>
<td>94.09</td>
<td>60.42</td>
<td>61.47</td>
<td>91.64</td>
<td>96.68</td>
<td>27.44</td>
<td>33.72</td>
<td>35.55</td>
<td>34.89</td>
<td>37.20</td>
<td>68.28</td>
<td>83.66</td>
<td>48.50</td>
<td>22.19</td>
<td>67.38</td>
<td>60.68</td>
<td>46.77</td>
<td>86.17</td>
<td>47.33</td>
<td>98.80</td>
<td>68.70</td>
<td>94.39</td>
<td>85.68</td>
<td>57.07</td>
<td>68.78</td>
<td>84.63</td>
<td>79.69</td>
<td>72.34</td>
<td>77.55</td>
<td>94.72</td>
<td>40.12</td>
<td>73.87</td>
</tr>
</tbody>
</table>

</div>

Compare the calculated percentile with the target, they are very
similar. The differences are due to raw data rounding.

## Compare

``` python
(target-percentile).abs().max().sort_values()
```

    MERTK        0.45
    PTK2B        0.51
    AXL          0.53
    SRC          0.64
    ROS1         0.65
                 ... 
    NTRK1        2.18
    TESK1_TYR    2.19
    JAK2         2.30
    FLT3         2.31
    LIMK2_TYR    2.67
    Length: 93, dtype: float64

No much difference between the two

``` python
# save the result for reference
# result.round(3).to_parquet('ochoa_pspa_score.parquet')
```

## To use

We’ve saved the reference sheet in `Data` and can load using the below
function:

``` python
pct_ref = Data.get_ochoa_score()
```

``` python
score_df = predict_kinase_df(df,'site_seq',**param_PSPA)
```

    input dataframe has a length 35
    Preprocessing
    Finish preprocessing
    Calculating position: [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4]

      0%|          | 0/303 [00:00<?, ?it/s]/usr/local/lib/python3.9/dist-packages/katlas/core.py:575: RuntimeWarning: divide by zero encountered in log2
      log_sum = np.sum(np.log2(values)) + (len(values) - 1) * np.log2(divide)
    100%|██████████| 303/303 [00:00<00:00, 1096.01it/s]

``` python
pct = get_pct_df(score_df,pct_ref)
```

``` python
site = 'PGGNIyIsPLksPyk'
get_pct(site,pct_ref)
```

# Preprocess Large-scale dataset


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
import pandas as pd
```

``` python
df = pd.read_csv('raw/Large_scale_S2.csv')
```

``` python
# Add substrate and phos position info
df['Substrate'] = df.Substrate_uniprot.str.split('_').str[0]
df['substrate_position'] = df['Substrate'] + "_"+ df['Position']
```

## EDA - Pivot table

***index is unique phosphosites and column is kinase***

``` python
p = df.pivot_table(index='substrate_position',
                   columns='Kinase',
                   values='Substrate', # any column
                   aggfunc='count',
                   fill_value=0)
```

``` python
p
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th">Kinase</th>
<th data-quarto-table-cell-role="th">ABL1</th>
<th data-quarto-table-cell-role="th">ABL1[E255K]</th>
<th data-quarto-table-cell-role="th">ABL1[T315I]</th>
<th data-quarto-table-cell-role="th">ABL2</th>
<th data-quarto-table-cell-role="th">ACK</th>
<th data-quarto-table-cell-role="th">ACTR2</th>
<th data-quarto-table-cell-role="th">ACTR2B</th>
<th data-quarto-table-cell-role="th">AKT1</th>
<th data-quarto-table-cell-role="th">AKT2</th>
<th data-quarto-table-cell-role="th">AKT3</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ZAK</th>
<th data-quarto-table-cell-role="th">ZAP70</th>
<th data-quarto-table-cell-role="th">p38a</th>
<th data-quarto-table-cell-role="th">p38b</th>
<th data-quarto-table-cell-role="th">p38d</th>
<th data-quarto-table-cell-role="th">p38g</th>
<th data-quarto-table-cell-role="th">p70S6K</th>
<th data-quarto-table-cell-role="th">p70S6Kb</th>
<th data-quarto-table-cell-role="th">skMLCK</th>
<th data-quarto-table-cell-role="th">smMLCK</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">substrate_position</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1433B_S132</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1433B_S145</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1433B_S147</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1433B_S158</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1433B_S212</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZW10_S611</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ZYX_S259</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZYX_S267</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ZYX_S505</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZYX_T270</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>21449 rows Ã— 385 columns</p>
</div>

``` python
# Check mutation
for kinase_with_mutation in ['ABL','ALK','BRAF','EGFR','FGFR3',
                             'KIT','LRRK2','MET','PDGFRa','RET']:
    print(p[p.columns[p.columns.str.contains(kinase_with_mutation)]].sum().reset_index(name='#substrates'))
    print('---------------')
```

            Kinase  #substrates
    0         ABL1         1577
    1  ABL1[E255K]         1274
    2  ABL1[T315I]         1322
    3         ABL2         1004
    ---------------
            Kinase  #substrates
    0          ALK         1876
    1         ALK1           29
    2         ALK2          331
    3         ALK4          463
    4  ALK[F1174L]         1111
    5  ALK[R1275Q]         1044
    ---------------
            Kinase  #substrates
    0         BRAF           22
    1  BRAF[V600E]          195
    ---------------
                  Kinase  #substrates
    0               EGFR          796
    1        EGFR[L858R]          648
    2        EGFR[L861Q]          981
    3  EGFR[T790M/L858R]         1112
    4        EGFR[T790M]         1086
    ---------------
             Kinase  #substrates
    0         FGFR3          775
    1  FGFR3[K650E]          827
    2  FGFR3[K650M]         1220
    ---------------
           Kinase  #substrates
    0         KIT          786
    1  KIT[T670I]          674
    2  KIT[V560G]          172
    ---------------
              Kinase  #substrates
    0          LRRK2           59
    1  LRRK2[G2019S]           11
    ---------------
            Kinase  #substrates
    0          MET         1457
    1  MET[Y1235D]          511
    ---------------
              Kinase  #substrates
    0         PDGFRa         1194
    1  PDGFRa[T674I]          249
    2  PDGFRa[V561D]         1175
    ---------------
           Kinase  #substrates
    0         RET         1735
    1  RET[G691S]         1165
    2  RET[M918T]         1221
    3  RET[S891A]          876
    4  RET[Y791F]          860
    ---------------

``` python
# Number of substrates of kinase
p.sum().sort_values(ascending=False)
```

    Kinase
    EPHA3             2102
    FES               2008
    TRKC              1928
    SRC               1899
    EPHA8             1878
                      ... 
    PKN3                 6
    SPHK1                4
    PIK3CD/PIK3R1        3
    PFTAIRE1/cycD3       2
    PRPK                 2
    Length: 385, dtype: int64

``` python
# Most phosphorylated substrates
p.sum(1).sort_values(ascending=False)
```

    substrate_position
    HSPB1_S82     307
    ALDOA_S39     191
    HS90B_S462    189
    RS29_Y7       185
    RS16_S9       180
                 ... 
    ZN768_Y359      1
    ZN687_S316      1
    ZN706_Y39       1
    1433F_T210      1
    1433F_T231      1
    Length: 21449, dtype: int64

***index is unique substrates and column is kinase***

``` python
p2 = df.pivot_table(index='Substrate',
                   columns='Kinase',
                   values='Type', # any column
                   aggfunc='count',
                   fill_value=0)
```

``` python
p2
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th">Kinase</th>
<th data-quarto-table-cell-role="th">ABL1</th>
<th data-quarto-table-cell-role="th">ABL1[E255K]</th>
<th data-quarto-table-cell-role="th">ABL1[T315I]</th>
<th data-quarto-table-cell-role="th">ABL2</th>
<th data-quarto-table-cell-role="th">ACK</th>
<th data-quarto-table-cell-role="th">ACTR2</th>
<th data-quarto-table-cell-role="th">ACTR2B</th>
<th data-quarto-table-cell-role="th">AKT1</th>
<th data-quarto-table-cell-role="th">AKT2</th>
<th data-quarto-table-cell-role="th">AKT3</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ZAK</th>
<th data-quarto-table-cell-role="th">ZAP70</th>
<th data-quarto-table-cell-role="th">p38a</th>
<th data-quarto-table-cell-role="th">p38b</th>
<th data-quarto-table-cell-role="th">p38d</th>
<th data-quarto-table-cell-role="th">p38g</th>
<th data-quarto-table-cell-role="th">p70S6K</th>
<th data-quarto-table-cell-role="th">p70S6Kb</th>
<th data-quarto-table-cell-role="th">skMLCK</th>
<th data-quarto-table-cell-role="th">smMLCK</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Substrate</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1433B</td>
<td>4</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1433E</td>
<td>3</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1433F</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>4</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1433G</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1433S</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZO1</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ZO2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZRAB2</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>2</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ZW10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZYX</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4128 rows Ã— 385 columns</p>
</div>

Find substrates that share same kinase pattern

``` python
p2[p2.duplicated(keep=False)].sort_values(list(p2.columns))
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th">Kinase</th>
<th data-quarto-table-cell-role="th">ABL1</th>
<th data-quarto-table-cell-role="th">ABL1[E255K]</th>
<th data-quarto-table-cell-role="th">ABL1[T315I]</th>
<th data-quarto-table-cell-role="th">ABL2</th>
<th data-quarto-table-cell-role="th">ACK</th>
<th data-quarto-table-cell-role="th">ACTR2</th>
<th data-quarto-table-cell-role="th">ACTR2B</th>
<th data-quarto-table-cell-role="th">AKT1</th>
<th data-quarto-table-cell-role="th">AKT2</th>
<th data-quarto-table-cell-role="th">AKT3</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ZAK</th>
<th data-quarto-table-cell-role="th">ZAP70</th>
<th data-quarto-table-cell-role="th">p38a</th>
<th data-quarto-table-cell-role="th">p38b</th>
<th data-quarto-table-cell-role="th">p38d</th>
<th data-quarto-table-cell-role="th">p38g</th>
<th data-quarto-table-cell-role="th">p70S6K</th>
<th data-quarto-table-cell-role="th">p70S6Kb</th>
<th data-quarto-table-cell-role="th">skMLCK</th>
<th data-quarto-table-cell-role="th">smMLCK</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Substrate</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ATS1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CARM1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CLN3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">DPOE1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EHMT2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PP2AB</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACTB</td>
<td>6</td>
<td>7</td>
<td>5</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>...</td>
<td>11</td>
<td>4</td>
<td>6</td>
<td>4</td>
<td>7</td>
<td>5</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ACTG</td>
<td>6</td>
<td>7</td>
<td>5</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>...</td>
<td>11</td>
<td>4</td>
<td>6</td>
<td>4</td>
<td>7</td>
<td>5</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TBA1A</td>
<td>7</td>
<td>4</td>
<td>4</td>
<td>6</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>2</td>
<td>3</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TBA1B</td>
<td>7</td>
<td>4</td>
<td>4</td>
<td>6</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>2</td>
<td>3</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>869 rows Ã— 385 columns</p>
</div>

## ID mapping

Query the uniprot id of substrates in the uniprot web

``` python
seq=pd.read_excel('raw/id_mapping.xlsx')

seq = seq.rename(columns={'From':'uniprot','Sequence':'sequence'})
```

``` python
df = pd.read_csv('raw/Large_scale_S2.csv').rename(columns={'Substrate_uniprot':'uniprot'})
```

``` python
df
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Kinase</th>
<th data-quarto-table-cell-role="th">uniprot</th>
<th data-quarto-table-cell-role="th">Position</th>
<th data-quarto-table-cell-role="th">SIDIC</th>
<th data-quarto-table-cell-role="th">PTMscore\n(P &gt; 075)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>S212</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>Y151</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>Y21</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>Y50</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>TK</td>
<td>ABL1</td>
<td>1433E_HUMAN</td>
<td>Y152</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">198531</td>
<td>LK</td>
<td>SPHK2</td>
<td>TICN3_HUMAN</td>
<td>T118</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">198532</td>
<td>LK</td>
<td>SPHK2</td>
<td>TPM4_HUMAN</td>
<td>T241</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">198533</td>
<td>LK</td>
<td>SPHK2</td>
<td>ULK3_HUMAN</td>
<td>S305</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">198534</td>
<td>LK</td>
<td>SPHK2</td>
<td>ZRAB2_HUMAN</td>
<td>S165</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">198535</td>
<td>LK</td>
<td>SPHK2</td>
<td>ZRAB2_HUMAN</td>
<td>S181</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>198536 rows Ã— 6 columns</p>
</div>

``` python
df = df.merge(seq)
```

``` python
# Extract amino acid and position from "Position"
df['phospho_receptor'] = df['Position'].str[0]

df['phospho_position'] = df['Position'].str[1:].astype(int)
```

``` python
df.phospho_receptor.value_counts()
```

    phospho_receptor
    Y    106611
    S     63242
    T     28683
    Name: count, dtype: int64

``` python
def validate_position(row):
    # Extract amino acid and position from the new columns
    amino_acid = row['phospho_receptor']
    position = int(row['phospho_position'])
    
    try:
        # Check if the amino acid at the given position matches the specified amino acid
        if row['sequence'][position-1] == amino_acid:
            return 1
        else:
            return 0
    except IndexError:  # Handle the case when position-1 exceeds the length of sequence
        return 0
```

``` python
df['Validated'] = df.apply(validate_position, axis=1)
```

``` python
df.Validated.value_counts()
```

    Validated
    1    196126
    0      2410
    Name: count, dtype: int64

``` python
df.query('Validated==0').uniprot.value_counts()
```

    uniprot
    EFTU_HUMAN     339
    DDX17_HUMAN    217
    ARI1B_HUMAN    114
    ANM1_HUMAN      95
    MIER1_HUMAN     87
                  ... 
    PAR14_HUMAN      1
    ZNF30_HUMAN      1
    RGS10_HUMAN      1
    RAB4A_HUMAN      1
    WDR81_HUMAN      1
    Name: count, Length: 97, dtype: int64

Find substrate that does not have ideal amino acid at the position

``` python
invalid = df.query('Validated==0').uniprot.value_counts().reset_index(name='count')\
.rename(columns={'index':'uniprot'})\
.merge(seq)

invalid
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">uniprot</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">sequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>EFTU_HUMAN</td>
<td>339</td>
<td>MTTMAAATLLRATPHFSGLAAGRTFLLQGLLRLLKAPALPLLCRGL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>DDX17_HUMAN</td>
<td>217</td>
<td>MPTGFVAPILCVLLPSPTREAATVASATGDSASERESAAPAAAPTA...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ARI1B_HUMAN</td>
<td>114</td>
<td>MAARAAAAAAAAAARARARAGSGERRAPPGPRPAPGARDLEAGARG...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ANM1_HUMAN</td>
<td>95</td>
<td>MAAAEAANCIMENFVATLANGMSLQPPLEEVSCGQAESSEKPNAED...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MIER1_HUMAN</td>
<td>87</td>
<td>MAEPSVESSSPGGSATSDDHEFDPSADMLVHDFDDERTLEEEEMME...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">92</td>
<td>PAR14_HUMAN</td>
<td>1</td>
<td>MAVPGSFPLLVEGSWGPDPPKNLNTKLQMYFQSPKRSGGGECEVRQ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">93</td>
<td>ZNF30_HUMAN</td>
<td>1</td>
<td>MAHKYVGLQYHGSVTFEDVAIAFSQQEWESLDSSQRGLYRDVMLEN...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">94</td>
<td>RGS10_HUMAN</td>
<td>1</td>
<td>MFNRAVSRLSRKRPPSDIHDSDGSSSSSHQSLKSTAKWAASLENLL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">95</td>
<td>RAB4A_HUMAN</td>
<td>1</td>
<td>MSQTAMSETYDFLFKFLVIGNAGTGKSCLLHQFIEKKFKDDSNHTI...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>WDR81_HUMAN</td>
<td>1</td>
<td>MAQGSGGREGALRTPAGGWHSPPSPDMQELLRSVERDLSIDPRQLA...</td>
</tr>
</tbody>
</table>

<p>97 rows Ã— 3 columns</p>
</div>

## Replace the invalidated sequence with updated sequence

``` python
# updated with valid sequences from old uniprot database
update1 = pd.read_excel('raw/seq.xlsx')
```

``` python
# full sequence
seq = pd.read_csv('raw/large_scale_sequence.csv').drop(columns=['uniprot_updated'])
```

``` python
# get a new column "sequence_new" that shows the updated sequence
result = seq.merge(update1,on='uniprot',how='left',suffixes=('', '_new'))

# Where a new sequence is available, replace the old sequence
result['sequence'] = result['sequence_new'].combine_first(result['sequence'])

# Drop the auxiliary columns
result = result.drop(columns=['sequence_new'])

seq = result.copy()
```

``` python
seq
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">uniprot</th>
<th data-quarto-table-cell-role="th">sequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1433B_HUMAN</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1433E_HUMAN</td>
<td>MDDREDLVYQAKLAEQAERYDEMVESMKKVAGMDVELTVEERNLLS...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1433F_HUMAN</td>
<td>MGDREQLLQRARLAEQAERYDDMASAMKAVTELNEPLSNEDRNLLS...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1433G_HUMAN</td>
<td>MVDREQLVQKARLAEQAERYDDMAAAMKNVTELNEPLSNEERNLLS...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1433S_HUMAN</td>
<td>MERASLIQKAKLAEQAERYEDMAAFMKGAVEKGEELSCEERNLLSV...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4123</td>
<td>1B42_HUMAN</td>
<td>MLVMAPRTVLLLLSAALALTETWAGSHSMRYFYTSVSRPGRGEPRF...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4124</td>
<td>FA21D_HUMAN</td>
<td>MRGKRRPQTRAARRLAAQESSEAEDMSVPRGPIAQWADGAISPNGH...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4125</td>
<td>1C06_HUMAN</td>
<td>MRVMAPRTLILLLSGALALTETWACSHSMRYFDTAVSRPGRGEPRF...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4126</td>
<td>MPP6_HUMAN</td>
<td>MQQVLENLTELPSSTGAEEIDLIFLKGIMENPIVKSLAKAHERLED...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4127</td>
<td>1C16_HUMAN</td>
<td>MRVMAPRALLLLLSGGLALTETWACSHSMRYFDTAVSRPGRGEPRF...</td>
</tr>
</tbody>
</table>

<p>4128 rows Ã— 2 columns</p>
</div>

## Validate again

``` python
import pandas as pd
```

``` python
df = pd.read_csv('raw/Large_scale_S2.csv').rename(columns={'Substrate_uniprot':'uniprot'})
```

``` python
df = df.merge(result)
```

``` python
# Extract amino acid and position from "Position"
df['phospho_receptor'] = df['Position'].str[0]
df['phospho_position'] = df['Position'].str[1:].astype(int)
```

``` python
def validate_position(row):
    # Extract amino acid and position from the new columns
    amino_acid = row['phospho_receptor']
    position = int(row['phospho_position'])
    
    try:
        # Check if the amino acid at the given position matches the specified amino acid
        if row['sequence'][position-1] == amino_acid:
            return 1
        else:
            return 0
    except IndexError:  # Handle the case when position-1 exceeds the length of sequence
        return 0
```

``` python
df['Validated'] = df.apply(validate_position, axis=1)
```

``` python
# invalidated
df.query('Validated==0').shape
```

    (215, 10)

Much less than before (2410) !

``` python
invalid = df.query('Validated==0')
```

``` python
# remove uniprot that has invalid phosphoreceptor, and drop sequence column
df = df[~df.uniprot.isin(invalid.uniprot)].drop(columns=['sequence'])
```

``` python
# as we modify the sequence, we need to replace with new sequence
df = df.merge(result)
```

``` python
df
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Kinase</th>
<th data-quarto-table-cell-role="th">uniprot</th>
<th data-quarto-table-cell-role="th">Position</th>
<th data-quarto-table-cell-role="th">SIDIC</th>
<th data-quarto-table-cell-role="th">PTMscore\n(P &gt; 075)</th>
<th data-quarto-table-cell-role="th">phospho_receptor</th>
<th data-quarto-table-cell-role="th">phospho_position</th>
<th data-quarto-table-cell-role="th">Validated</th>
<th data-quarto-table-cell-role="th">sequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>S212</td>
<td>1</td>
<td>1</td>
<td>S</td>
<td>212</td>
<td>1</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>Y151</td>
<td>1</td>
<td>1</td>
<td>Y</td>
<td>151</td>
<td>1</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>Y21</td>
<td>1</td>
<td>1</td>
<td>Y</td>
<td>21</td>
<td>1</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>TK</td>
<td>ABL1</td>
<td>1433B_HUMAN</td>
<td>Y50</td>
<td>1</td>
<td>1</td>
<td>Y</td>
<td>50</td>
<td>1</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>TK</td>
<td>ABL2</td>
<td>1433B_HUMAN</td>
<td>Y106</td>
<td>1</td>
<td>1</td>
<td>Y</td>
<td>106</td>
<td>1</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">198243</td>
<td>LK</td>
<td>SPHK2</td>
<td>SPHK2_HUMAN</td>
<td>T389</td>
<td>1</td>
<td>1</td>
<td>T</td>
<td>389</td>
<td>1</td>
<td>MNGHLEAEEQQDQRPDQELTGSWGHGPRSTLVRAKAMAPPPPPLAA...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">198244</td>
<td>LK</td>
<td>SPHK2</td>
<td>SPHK2_HUMAN</td>
<td>T402</td>
<td>1</td>
<td>1</td>
<td>T</td>
<td>402</td>
<td>1</td>
<td>MNGHLEAEEQQDQRPDQELTGSWGHGPRSTLVRAKAMAPPPPPLAA...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">198245</td>
<td>LK</td>
<td>SPHK2</td>
<td>SPHK2_HUMAN</td>
<td>T404</td>
<td>1</td>
<td>1</td>
<td>T</td>
<td>404</td>
<td>1</td>
<td>MNGHLEAEEQQDQRPDQELTGSWGHGPRSTLVRAKAMAPPPPPLAA...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">198246</td>
<td>LK</td>
<td>SPHK2</td>
<td>SPHK2_HUMAN</td>
<td>T503</td>
<td>1</td>
<td>1</td>
<td>T</td>
<td>503</td>
<td>1</td>
<td>MNGHLEAEEQQDQRPDQELTGSWGHGPRSTLVRAKAMAPPPPPLAA...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">198247</td>
<td>LK</td>
<td>SPHK2</td>
<td>SPHK2_HUMAN</td>
<td>T614</td>
<td>1</td>
<td>1</td>
<td>T</td>
<td>614</td>
<td>1</td>
<td>MNGHLEAEEQQDQRPDQELTGSWGHGPRSTLVRAKAMAPPPPPLAA...</td>
</tr>
</tbody>
</table>

<p>198248 rows Ã— 10 columns</p>
</div>

## Convert substrate sequence to lower case

``` python
# for each substrate, find their phosphorylation point
modify = df.groupby('uniprot').agg({'Position':lambda r: r.unique()}).reset_index()
```

``` python
modify = modify.merge(result)
```

``` python
modify
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">uniprot</th>
<th data-quarto-table-cell-role="th">Position</th>
<th data-quarto-table-cell-role="th">sequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1433B_HUMAN</td>
<td>[S212, Y151, Y21, Y50, Y106, Y213, S47, S39, T...</td>
<td>MTMDKSELVQKAKLAEQAERYDDMAAAMKAVTEQGHELSNEERNLL...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1433E_HUMAN</td>
<td>[Y152, Y20, Y49, Y214, S148, S46, Y131, Y121, ...</td>
<td>MDDREDLVYQAKLAEQAERYDEMVESMKKVAGMDVELTVEERNLLS...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1433F_HUMAN</td>
<td>[S215, Y154, Y20, Y49, S46, S150, Y216, S145, ...</td>
<td>MGDREQLLQRARLAEQAERYDDMASAMKAVTELNEPLSNEDRNLLS...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1433G_HUMAN</td>
<td>[S215, Y20, Y216, Y49, S46, S38, T31, S64, Y12...</td>
<td>MVDREQLVQKARLAEQAERYDDMAAAMKNVTELNEPLSNEERNLLS...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1433S_HUMAN</td>
<td>[S149, Y151, Y19, Y213, Y48, S45, S209, S37, T...</td>
<td>MERASLIQKAKLAEQAERYEDMAAFMKGAVEKGEELSCEERNLLSV...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4094</td>
<td>ZO1_HUMAN</td>
<td>[Y1165, Y669, S1064, Y1354, Y1355, Y1066, S106...</td>
<td>MSARAAAAKSTAMEETAIWEQHTVTLHRAPGFGFGIAISGGRDNPH...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4095</td>
<td>ZO2_HUMAN</td>
<td>[Y506, S430, Y426, Y1166]</td>
<td>MPVRGDRGFPPRRELSGWLRAPGMEELIWEQYTVTLQKDSKRGFGI...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4096</td>
<td>ZRAB2_HUMAN</td>
<td>[S188, T100, Y167, S120, Y114, Y124, S181, S15...</td>
<td>MSTKNFRVSDGDWICPDKKCGNVNFARRTSCNRCGREKTTEAKMMK...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4097</td>
<td>ZW10_HUMAN</td>
<td>[S605, S611]</td>
<td>MASFVTEVLAHSGRLEKEDLGTRISRLTRRVEEIKGEVCNMISKKY...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4098</td>
<td>ZYX_HUMAN</td>
<td>[S505, S259, S267, T270]</td>
<td>MAAPRPSPAISVSVSAPAFYAPQKKFGPVVAPKPKVNPFRPGDSEP...</td>
</tr>
</tbody>
</table>

<p>4099 rows Ã— 3 columns</p>
</div>

``` python
# Modify sequence based on position
def modify_sequence(row):
    seq = list(row['sequence'])
    for pos in row['Position']:
        # Extract character and position
        char = pos[0]
        position = int(pos[1:]) - 1  # Subtracting 1 because Python uses 0-based indexing
        
        # Check if the character at the position matches
        # if seq[position] == char:
        seq[position] = char.lower()
    return ''.join(seq)
```

``` python
modify['sequence2'] = modify.apply(modify_sequence, axis=1)
```

``` python
seq2 = modify[['uniprot','sequence2']]
```

``` python
# merge with transformed sequence
df = df.drop(columns=['sequence']).merge(seq2)
```

``` python
df.Kinase.value_counts()
```

    Kinase
    EPHA3             2101
    FES               2007
    TRKC              1926
    SRC               1896
    EPHA8             1877
                      ... 
    PKN3                 6
    SPHK1                4
    PIK3CD/PIK3R1        3
    PFTAIRE1/cycD3       2
    PRPK                 2
    Name: count, Length: 385, dtype: int64

## Extract phosphosite sequence

``` python
data = []
for i, r in df.iterrows():
    position = r.phospho_position - 1
    start = position - 7
    end = position + 8

    # Extract the subsequence
    subseq = r.sequence2[max(0, start):min(len(r.sequence2), end)]

    # Pad the subsequence if needed
    if start < 0:
        subseq = "_" * abs(start) + subseq
    if end > len(r.sequence2):
        subseq = subseq + "_" * (end - len(r.sequence2))
    
    data.append(subseq)
    # break
```

``` python
df['substrate'] = data
```

``` python
# check if the middle position belongs to s,t,y
df.substrate.str[7].value_counts()
```

    substrate
    y    106558
    s     63030
    t     28660
    Name: count, dtype: int64

``` python
# check if the middle position belongs to s,t,y
df.substrate.apply(len).value_counts()
```

    substrate
    15    198248
    Name: count, dtype: int64

``` python
df.substrate.value_counts()[:10]
```

    substrate
    IEQEGPEyWDRNTQI    1085
    RKEsysVyVyKVLKQ     765
    SSSLEKsyELPDGQV     765
    VGMGQKDsyVGDEAQ     750
    EsysVyVyKVLKQVH     729
    TLNNKFAsFIDKVRF     708
    MWISKQEyDEsGPsI     693
    LPDGQVItIGNERFR     610
    EyDEsGPsIVHRKCF     594
    QGNRttPsyVAFtDt     556
    Name: count, dtype: int64

``` python
df['KS_pairs'] = df.Kinase+"_"+df.uniprot.str.split('_').str[0]+"_"+df.Position

df['S_position'] = df.uniprot.str.split('_').str[0]+"_"+df.Position

df['Uniprot'] = df.uniprot.str.split('_').str[0]
```

Check the most frequence substrate sequence

``` python
df.query('substrate == "RKEsysVyVyKVLKQ"').S_position.value_counts()
```

    S_position
    H2B1C_Y41    85
    H2B1D_Y41    85
    H2B1H_Y41    85
    H2B1K_Y41    85
    H2B1L_Y41    85
    H2B1M_Y41    85
    H2B1N_Y41    85
    H2B2F_Y41    85
    H2BFS_Y41    85
    Name: count, dtype: int64

Check if the sequences of these substrates are identical

``` python
name = df.query('substrate == "RKEsysVyVyKVLKQ"').S_position.value_counts().index

df[df.S_position.isin(name)].sequence2.unique()
```

    array(['MPEPAKSAPAPKKGSKKAVTKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPEPTKSAPAPKKGSKKAVTKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPDPAKSAPAPKKGSKKAVTKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPEPAKSAPAPKKGSKKAVTKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSAK',
           'MPELAKSAPAPKKGSKKAVTKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIASEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPEPVKSAPVPKKGSKKAINKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPEPSKSAPAPKKGSKKAVTKAQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPDPAKSAPAPKKGSKKAVTKVQKKDGKKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSSK',
           'MPEPAKSAPAPKKGSKKAVTKAQKKDGRKRKRSRKEsysVyVyKVLKQVHPDTGISSKAMGIMNSFVNDIFERIAGEASRLPHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSAK'],
          dtype=object)

## Save

``` python
df.shape
```

    (198248, 14)

``` python
# df.to_excel('raw/large_scale_final2.xlsx',index=False)
```
